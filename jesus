<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Infograf√≠a: Autoridades Fiscales y Lucha Anticorrupci√≥n en Panam√°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #F9FAFB; }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 350px;
            max-height: 400px;
            padding: 1rem;
        }
        .section-anchor { scroll-margin-top: 5rem; }
    </style>
</head>
<body class="text-gray-800">

    <!-- Sticky Navigation -->
    <nav id="nav-menu" class="sticky top-0 z-20 bg-white shadow-lg border-b border-blue-100">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex-shrink-0 text-xl font-extrabold text-[#1E3A8A]">
                    FISCALIZACI√ìN üáµüá¶
                </div>
                <div class="hidden sm:ml-6 sm:flex sm:space-x-8">
                    <a href="#contexto" class="text-gray-900 hover:text-[#3B82F6] px-3 py-2 rounded-md text-sm font-medium transition duration-150">Contexto</a>
                    <a href="#operacion" class="text-gray-900 hover:text-[#3B82F6] px-3 py-2 rounded-md text-sm font-medium transition duration-150">Mecanismos</a>
                    <a href="#justicia" class="text-gray-900 hover:text-[#3B82F6] px-3 py-2 rounded-md text-sm font-medium transition duration-150">Cooperaci√≥n</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content Container -->
    <main class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8">

        <!-- Header and Lead KPI -->
        <section class="mb-12 text-center">
            <h1 class="text-4xl sm:text-5xl font-extrabold text-[#1E3A8A] mb-4">
                El Fracaso del Control: An√°lisis Anticorrupci√≥n en Panam√°
            </h1>
            <p class="text-lg text-gray-600 max-w-3xl mx-auto mb-8">
                Esta infograf√≠a interactiva desglosa nuestro informe sobre las Autoridades Fiscales y la Lucha Anticorrupci√≥n en Panam√°, examinando los mecanismos de auditor√≠a, el conflicto de control y los obst√°culos interinstitucionales que impiden la recuperaci√≥n efectiva del patrimonio p√∫blico.
            </p>
            <div class="bg-white p-8 rounded-xl shadow-2xl border-b-4 border-[#3B82F6] inline-block">
                <p class="text-sm font-medium text-gray-500 uppercase">
                    Puntaje CPI Panam√° (2024)
                </p>
                <p class="text-6xl font-extrabold text-[#EF4444]">
                    35/100
                </p>
                <p class="text-sm text-gray-500">
                    Fuente: Transparencia Internacional
                </p>
            </div>
        </section>

        <!-- Section 1: El Contexto (Context & Perception) -->
        <section id="contexto" class="section-anchor pt-10 mb-16">
            <h2 class="text-3xl font-bold text-[#1E3A8A] border-b-2 border-blue-200 pb-2 mb-6">1. Contexto y Evoluci√≥n del Riesgo</h2>
            <p class="text-gray-700 mb-8">
                El √çndice de Percepci√≥n de la Corrupci√≥n (CPI) sit√∫a a Panam√° en un riesgo elevado, lo que refleja la urgencia de fortalecer las herramientas fiscales. El fracaso en la aplicaci√≥n de la ley y la impunidad percibida se reflejan en la tendencia hist√≥rica de este indicador.
            </p>

            <div class="bg-white p-6 rounded-xl shadow-lg">
                <h3 class="text-xl font-semibold mb-4 text-[#1E3A8A]">Tendencia Hist√≥rica del CPI (2020 - 2024)</h3>
                <div class="chart-container">
                    <canvas id="cpiTrendChart"></canvas>
                </div>
                <p class="text-sm text-gray-600 mt-4 p-2 bg-blue-50 rounded-lg">
                    <span class="font-bold">An√°lisis:</span> La l√≠nea muestra una tendencia estancada o de leve deterioro, lo que subraya la necesidad de un impacto real y visible de las autoridades fiscales y de justicia. La corrupci√≥n no disminuye sin una persecuci√≥n efectiva.
                </p>
            </div>
        </section>

        <!-- Section 2: La Operaci√≥n (Mechanisms & Tools) -->
        <section id="operacion" class="section-anchor pt-10 mb-16">
            <h2 class="text-3xl font-bold text-[#1E3A8A] border-b-2 border-blue-200 pb-2 mb-6">2. Mecanismos de Control y el Dilema del Refrendo</h2>
            <p class="text-gray-700 mb-8">
                La Contralor√≠a General de la Rep√∫blica (CGR) utiliza diferentes tipos de auditor√≠a, pero la eficacia se ve comprometida por el predominio del Control Previo (refrendo) sobre la investigaci√≥n profunda y el posterior proceso judicial.
            </p>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <!-- Chart 2: Audit Focus -->
                <div class="bg-white p-6 rounded-xl shadow-lg">
                    <h3 class="text-xl font-semibold mb-4 text-[#1E3A8A]">Enfoque de Auditor√≠as de la CGR (2023)</h3>
                    <div class="chart-container h-80 max-h-80">
                        <canvas id="auditFocusChart"></canvas>
                    </div>
                    <p class="text-sm text-gray-600 mt-4 p-2 bg-blue-50 rounded-lg">
                        <span class="font-bold">Clave:</span> La gran mayor√≠a de los recursos se enfocan en Auditor√≠as de Cumplimiento (formalismo legal), dejando un vac√≠o cr√≠tico en la Auditor√≠a de Desempe√±o (eficiencia y sobrecostos).
                    </p>
                </div>

                <!-- Chart 3: Control Speed Comparison (Previo vs Posterior) -->
                <div class="bg-white p-6 rounded-xl shadow-lg">
                    <h3 class="text-xl font-semibold mb-4 text-[#1E3A8A]">Tiempo Promedio de Cierre (D√≠as)</h3>
                    <div class="chart-container h-80 max-h-80">
                        <canvas id="controlTimeChart"></canvas>
                    </div>
                    <p class="text-sm text-gray-600 mt-4 p-2 bg-red-50 rounded-lg">
                        <span class="font-bold">Impacto del Retraso:</span> Mientras el control previo es r√°pido (formalista), la auditor√≠a posterior que busca la lesi√≥n patrimonial tarda un promedio de 3.5 veces m√°s, permitiendo la prescripci√≥n de delitos.
                    </p>
                </div>

                <!-- Interactive Element: DGI's Role -->
                <div id="dgi-role-card" class="md:col-span-2 bg-white p-6 rounded-xl shadow-lg border-l-4 border-blue-400">
                    <h3 class="text-2xl font-bold text-[#1E3A8A] mb-3">La Fiscalizaci√≥n Tributaria (DGI)</h3>
                    <p class="text-gray-700 mb-4">
                        La Direcci√≥n General de Ingresos (DGI) es clave en la detecci√≥n de corrupci√≥n mediante el rastreo de gastos il√≠citos (deducciones falsas por sobornos) y el cruce de informaci√≥n con la CGR (empresas fantasma en PanamaCompra).
                    </p>
                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                        <div class="p-4 bg-gray-50 rounded-lg text-center shadow-inner">
                            <span class="text-4xl text-[#3B82F6]">üí∏</span>
                            <p class="font-bold mt-2 text-sm">Detecci√≥n de Sobornos</p>
                        </div>
                        <div class="p-4 bg-gray-50 rounded-lg text-center shadow-inner">
                            <span class="text-4xl text-[#3B82F6]">üîó</span>
                            <p class="font-bold mt-2 text-sm">Cruce de Data (PanamaCompra)</p>
                        </div>
                        <div class="p-4 bg-gray-50 rounded-lg text-center shadow-inner">
                            <span class="text-4xl text-[#1E3A8A]">üìà</span>
                            <p class="font-bold mt-2 text-sm">Sanci√≥n Fiscal a Empresas</p>
                        </div>
                    </div>
                </div>

                <!-- Gemini API Feature Card -->
                <div class="md:col-span-2 bg-gray-50 p-6 rounded-xl shadow-inner border-t-4 border-[#3B82F6]">
                    <h3 class="text-2xl font-bold text-[#1E3A8A] mb-3">Recomendaci√≥n de Pol√≠tica Estrat√©gica ‚ú®</h3>
                    <p class="text-gray-700 mb-4">
                        Utilice la IA para generar una recomendaci√≥n concisa de alto nivel dirigida a subsanar una de las fallas operacionales identificadas en el sistema de control paname√±o.
                    </p>

                    <div class="flex flex-col md:flex-row gap-4 mb-4 items-center">
                        <select id="riskArea" class="flex-grow p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-[#3B82F6] focus:border-[#3B82F6] transition duration-150">
                            <option value="predominio de Auditor√≠a de Cumplimiento sobre la de Desempe√±o">Falla: Predominio de Auditor√≠a de Cumplimiento</option>
                            <option value="retraso de 315 d√≠as en Auditor√≠a Posterior">Falla: Retraso de 315 d√≠as en Auditor√≠a Posterior</option>
                            <option value="falta de cruce de informaci√≥n CGR - DGI">Falla: Falta de Cruce de Informaci√≥n CGR-DGI</option>
                            <option value="silos institucionales entre CGR, MP y UAF">Falla: Silos Institucionales (CGR/MP/UAF)</option>
                        </select>
                        <button id="generateBtn" onclick="generateRecommendation()" class="w-full md:w-auto p-3 bg-[#3B82F6] text-white font-bold rounded-lg shadow-md hover:bg-[#1E3A8A] transition duration-200 flex items-center justify-center">
                            Generar Propuesta Estrat√©gica ‚ú®
                        </button>
                    </div>

                    <div id="recommendationOutput" class="mt-4 p-4 bg-white border border-blue-200 rounded-lg hidden">
                        <p class="font-semibold text-[#1E3A8A]">Resultado de la IA:</p>
                        <div id="loadingIndicator" class="hidden text-sm text-gray-500 italic flex items-center">
                            <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-[#3B82F6]" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                            Analizando el riesgo y redactando la pol√≠tica...
                        </div>
                        <p id="recommendationText" class="text-gray-800 mt-2"></p>
                    </div>
                </div>

            </div>
        </section>

        <!-- Section 3: La Cadena de Justicia (Cooperation & Funnel) -->
        <section id="justicia" class="section-anchor pt-10 mb-16">
            <h2 class="text-3xl font-bold text-[#1E3A8A] border-b-2 border-blue-200 pb-2 mb-6">3. Fugas en la Cadena de Cooperaci√≥n Interinstitucional</h2>
            <p class="text-gray-700 mb-8">
                El mayor desaf√≠o no es la detecci√≥n, sino la transici√≥n de un hallazgo administrativo a una condena judicial y la recuperaci√≥n del dinero. El proceso actual act√∫a como un embudo (funnel) con fugas cr√≠ticas.
            </p>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-12">
                <!-- Funnel Diagram (HTML/CSS) -->
                <div class="md:col-span-2 bg-white p-6 rounded-xl shadow-lg relative overflow-hidden">
                    <h3 class="text-xl font-semibold mb-4 text-[#1E3A8A]">El Embudo de la Impunidad (Simulado 2023)</h3>
                    <!-- Funnel Steps -->
                    <div class="flex flex-col items-center space-y-2">
                        <!-- Step 1 -->
                        <div class="w-full max-w-lg bg-[#3B82F6] text-white p-3 rounded-t-lg text-center font-bold">
                            CGR: Hallazgos con Lesi√≥n Patrimonial (100%)
                        </div>
                        <div class="text-[#3B82F6] text-3xl font-extrabold rotate-90">‚ü∂</div>

                        <!-- Step 2 -->
                        <div class="w-11/12 max-w-md bg-blue-400 text-white p-3 text-center font-bold">
                            MP: Denuncias Formalizadas (45%)
                        </div>
                        <div class="text-blue-400 text-3xl font-extrabold rotate-90">‚ü∂</div>

                        <!-- Step 3 -->
                        <div class="w-10/12 max-w-sm bg-blue-600 text-white p-3 text-center font-bold">
                            Fiscal√≠a Cuentas: Casos Remitidos (30%)
                        </div>
                        <div class="text-blue-600 text-3xl font-extrabold rotate-90">‚ü∂</div>

                        <!-- Step 4 -->
                        <div class="w-8/12 max-w-xs bg-[#1E3A8A] text-white p-3 rounded-b-lg text-center font-bold">
                            √ìrgano Judicial: Condenas Finales (5%)
                        </div>
                    </div>
                    <p class="text-sm text-gray-600 mt-4 p-2 bg-blue-50 rounded-lg">
                        <span class="font-bold">Hallazgo:</span> La mayor ca√≠da ocurre entre el informe de auditor√≠a y la formalizaci√≥n de la denuncia, reflejando problemas de calidad probatoria (Peritaje SPA) y cooperaci√≥n CGR/MP.
                    </p>
                </div>

                <!-- Chart 4: Cooperation Obstacles -->
                <div class="bg-white p-6 rounded-xl shadow-lg">
                    <h3 class="text-xl font-semibold mb-4 text-[#1E3A8A]">Principales Obst√°culos a la Cooperaci√≥n</h3>
                    <div class="chart-container h-96 max-h-96">
                        <canvas id="obstacleChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Conclusion Card -->
            <div class="bg-[#1E3A8A] p-8 rounded-xl shadow-2xl mt-10 text-white">
                <h3 class="text-3xl font-bold mb-3">La Ruta Cr√≠tica</h3>
                <p class="text-lg">
                    Nuestro informe concluye que, mientras Panam√° tiene el marco legal (Leyes 32/84, Ley 67/08), la batalla se pierde en la capacidad t√©cnica (Auditor√≠a Forense/Peritaje SPA) y la voluntad pol√≠tica de superar los silos institucionales (CGR, MP, UAF) que impiden la trazabilidad del dinero.
                </p>
            </div>
        </section>

    </main>

    <script>
        const DATA = {
            cpi: {
                labels: ['2020', '2021', '2022', '2023', '2024'],
                values: [37, 35, 36, 35, 35]
            },
            auditFocus: {
                labels: ['Cumplimiento', 'Financiera', ['Desempe√±o', '(Eficacia)'], 'Forenses'],
                values: [70, 18, 5, 7]
            },
            controlTime: {
                labels: ['Control Previo (Refrendo)', 'Auditor√≠a Posterior (Perjuicio)'],
                values: [90, 315]
            },
            obstacles: {
                labels: ['Silos Institucionales', ['Asimetr√≠a', 'Tecnol√≥gica'], 'Politizaci√≥n', 'Lentitud Procesal'],
                values: [
                    { name: 'Impacto Alto', data: [40, 25, 50, 30], color: '#EF4444' },
                    { name: 'Impacto Medio', data: [35, 45, 30, 40], color: '#3B82F6' },
                    { name: 'Impacto Bajo', data: [25, 30, 20, 30], color: '#9CA3AF' }
                ]
            }
        };

        function wrapLabels(labels) {
            return labels.map(label => {
                if (Array.isArray(label)) return label;
                if (label.length <= 16) return label;
                const words = label.split(' ');
                const lines = [];
                let currentLine = '';

                words.forEach(word => {
                    if ((currentLine + ' ' + word).trim().length <= 16) {
                        currentLine += (currentLine ? ' ' : '') + word;
                    } else {
                        if (currentLine) lines.push(currentLine);
                        currentLine = word;
                    }
                });
                if (currentLine) lines.push(currentLine);
                return lines;
            });
        }

        function createChart(chartId, type, data, options = {}) {
            const ctx = document.getElementById(chartId).getContext('2d');
            const defaultOptions = {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        labels: {
                            font: { family: 'Inter', size: 14 }
                        }
                    },
                    tooltip: {
                        callbacks: {
                            title: function(tooltipItems) {
                                const item = tooltipItems[0];
                                let label = item.chart.data.labels[item.dataIndex];
                                if (Array.isArray(label)) {
                                  return label.join(' ');
                                } else {
                                  return label;
                                }
                            }
                        }
                    }
                },
                scales: {}
            };
            return new Chart(ctx, {
                type: type,
                data: data,
                options: { ...defaultOptions, ...options }
            });
        }
        
        const apiKey = ""; 
        const apiUrl = "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=" + apiKey;

        async function fetchWithExponentialBackoff(url, options, maxRetries = 5) {
            for (let i = 0; i < maxRetries; i++) {
                try {
                    const response = await fetch(url, options);
                    if (response.status === 429 && i < maxRetries - 1) {
                        const delay = Math.pow(2, i) * 1000 + Math.random() * 1000;
                        await new Promise(resolve => setTimeout(resolve, delay));
                        continue;
                    }
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response;
                } catch (error) {
                    if (i === maxRetries - 1) throw error;
                    const delay = Math.pow(2, i) * 1000 + Math.random() * 1000;
                    await new Promise(resolve => setTimeout(resolve, delay));
                }
            }
        }

        async function generateRecommendation() {
            const riskArea = document.getElementById('riskArea').value;
            const outputDiv = document.getElementById('recommendationOutput');
            const textElement = document.getElementById('recommendationText');
            const loadingIndicator = document.getElementById('loadingIndicator');
            const generateBtn = document.getElementById('generateBtn');
            
            outputDiv.classList.remove('hidden');
            textElement.textContent = '';
            loadingIndicator.classList.remove('hidden');
            generateBtn.disabled = true;

            const systemPrompt = `Act√∫a como un analista de pol√≠ticas p√∫blicas especializado en Gobernanza y Lucha Anticorrupci√≥n en Panam√°. Tu tarea es generar una recomendaci√≥n estrat√©gica concisa (m√°ximo 100 palabras) para el Contralor General. La recomendaci√≥n debe ser profesional, enfocada en la soluci√≥n y adaptada al contexto institucional paname√±o (menciona CGR, MP, DGI o UAF si es pertinente). Proporciona solo el texto de la recomendaci√≥n.`;
            
            const userQuery = `Dada la falla operacional cr√≠tica: "${riskArea}", genera una recomendaci√≥n de pol√≠tica dirigida a mitigar este riesgo de corrupci√≥n en el sistema fiscal de Panam√°.`;
            
            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
            };

            try {
                const response = await fetchWithExponentialBackoff(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();
                const generatedText = result.candidates?.[0]?.content?.parts?.[0]?.text || "Error: No se pudo generar la recomendaci√≥n. Intente de nuevo.";
                textElement.textContent = generatedText;

            } catch (error) {
                textElement.textContent = `Error al conectar con la IA. Verifique su conexi√≥n o intente m√°s tarde.`;
                console.error("Gemini API Error:", error);
            } finally {
                loadingIndicator.classList.add('hidden');
                generateBtn.disabled = false;
            }
        }

        window.generateRecommendation = generateRecommendation;

        window.onload = function() {
            const primaryColor = '#3B82F6';
            const secondaryColor = '#EF4444';
            const tertiaryColor = '#9CA3AF';

            // Chart 1: CPI Trend (Line Chart)
            createChart('cpiTrendChart', 'line', {
                labels: DATA.cpi.labels,
                datasets: [{
                    label: 'Puntaje CPI',
                    data: DATA.cpi.values,
                    borderColor: primaryColor,
                    backgroundColor: 'rgba(59, 130, 246, 0.2)',
                    fill: true,
                    tension: 0.3
                }]
            }, {
                scales: {
                    y: {
                        min: 30,
                        max: 40,
                        title: { display: true, text: 'Puntaje (0-100)' }
                    },
                    x: {
                        title: { display: true, text: 'A√±o' }
                    }
                }
            });

            // Chart 2: Audit Focus (Donut Chart)
            createChart('auditFocusChart', 'doughnut', {
                labels: wrapLabels(DATA.auditFocus.labels),
                datasets: [{
                    data: DATA.auditFocus.values,
                    backgroundColor: [primaryColor, tertiaryColor, secondaryColor, '#1E3A8A'],
                    hoverOffset: 4
                }]
            });

            // Chart 3: Control Time Comparison (Bar Chart)
            createChart('controlTimeChart', 'bar', {
                labels: wrapLabels(DATA.controlTime.labels),
                datasets: [{
                    label: 'D√≠as Promedio',
                    data: DATA.controlTime.values,
                    backgroundColor: [primaryColor, secondaryColor],
                    borderRadius: 5
                }]
            }, {
                indexAxis: 'y',
                scales: {
                    x: {
                        beginAtZero: true,
                        title: { display: true, text: 'D√≠as' }
                    }
                }
            });

            // Chart 4: Cooperation Obstacles (Stacked Bar Chart)
            const obstacleDatasets = DATA.obstacles.values.map(item => ({
                label: item.name,
                data: item.data,
                backgroundColor: item.color,
                stack: 'stack'
            }));

            createChart('obstacleChart', 'bar', {
                labels: wrapLabels(DATA.obstacles.labels),
                datasets: obstacleDatasets
            }, {
                scales: {
                    x: {
                        stacked: true,
                        title: { display: true, text: 'Obst√°culo' }
                    },
                    y: {
                        stacked: true,
                        min: 0,
                        max: 100,
                        title: { display: true, text: 'Severidad (%)' }
                    }
                }
            });
        };
    </script>
</body>
</html>
